<head>
<meta name="viewport" content="width=device-width height=device-height initial-scale=1.0
                               minimum-scale=1.0 maximum-scale=1.0 user-scalable=no"/>
<title>Thinking for ever</title>
<style typw="text/css">
  a:link{
    color:lightgreen;
  }
  a:visited{
    color:lightgray;
  }
</style>
<script>
function gen_url(base_url,url){
  if(url.includes("://")){
    return url;
  }else{
    return `${base_url}/${url}`;
  }
}
function load_blog(){
let tips=document.getElementById("tips");
let blog_url=(new URL(document.location).searchParams).get("url");
if(blog_url==null){
  fetch("https://api.github.com/repos/alng-org/blog/contents/")
  .then(response => response.json())
  .then(blogs =>{
        tips.remove();
        for(let blog of blogs){
          if(blog.type=="dir"){
              document.body.innerHTML=document.body.innerHTML+
              `<a style="text-decoration:none;" href="?url=${blog.path}"><h3>${blog.name}</h3></a>`;
          }else{
              /*PASS*/
          }
        }
        return;
      });
}else{
  fetch(`${blog_url}/blog`)
  .then(response => response.text())
  .then(src => {
          tips.remove();
          let back=document.createElement("a");
          back.href=document.referrer;
          back.innerText="Back";
          document.body.append(back);
          let content=document.createElement("div");
          content.style.color="lightgreen";
          content.style.fontSize="1.2em";
          src=src.replace(/\n\r|\n|\r/g,"\n");
          br=document.createElement("br");
          for(let line of src.split("\n")){
            content.append(line);
            switch(line[0]){
              case "$": // $img_url
                let img=document.createElement("img");
                img.src=gen_url(blog_url,line.substr(1));
                content.append(img);
                break;
              case "&": // &text=url
                let link=document.createElement("a");
                let x=line.indexOf("=");
                let url=line.substr(x+1);
                let text=line.substr(1,x);
                link.href=gen_url(blog_url,url);
                link.innerText=text;
                content.append(link);
                break;
              case "\":
                line=line.substr(1); // \line escape line as normal text
              default:
                content.append(line);
            }
            content.append(br);
          } 
          document.body.append(content);
          return;
        });
}
  return;
}
</script>
</head>
<body onload="load_blog()">
<h1>Welcome to my blog.</h1>
<h5 id="tips">Please wait for loading</h5>
</body>
